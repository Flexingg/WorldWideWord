<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bible PWA</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:opsz,wght@8..144,400;500&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header id="mainHeader">
    <button class="nav-btn hidden" id="btnBack" onclick="App.navBack()"><span class="material-icons-round">arrow_back</span></button>
    <div style="display:flex; align-items:center; gap:4px; flex-grow:1">
        <button class="title-chip" onclick="App.goHome()">
            <span class="material-icons-round" style="color:var(--primary-color)">menu_book</span>
            <span id="headerLabel">The Bible</span>
        </button>
    </div>
    <div style="display:flex; align-items:center" id="headerActions">
        <button class="nav-btn hidden" id="btnStop" onclick="ReaderAudio.stop()"><span class="material-icons-round">stop_circle</span></button>
        <button class="nav-btn hidden" id="btnAudio" onclick="ReaderAudio.toggleUI()"><span class="material-icons-round">headphones</span><span id="dlStatus" class="dl-status"></span></button>
        <button class="nav-btn hidden" id="btnNextChap" onclick="Reader.navNext()"><span class="material-icons-round">chevron_right</span></button>
        <button class="icon-btn" onclick="App.toggleTheme()"><span class="material-icons-round" id="themeIcon">dark_mode</span></button>
    </div>
</header>

<main>
    <!-- VIEW 1: SELECTOR -->
    <section id="view-selector">
        <div class="search-wrapper">
            <div class="search-container" id="searchBox">
                <span class="material-icons-round" id="searchIcon">filter_list</span>
                <form onsubmit="Selector.handleSearch(event)">
                    <input type="text" id="searchInput" placeholder="Filter books..." onkeyup="Selector.handleInput(this.value)" autocomplete="off">
                </form>
            </div>
            <button class="mode-toggle" id="btnMode" onclick="Selector.toggleSearchMode()">
                <span class="material-icons-round">search</span>
            </button>
        </div>
        <div id="bookGrid" class="grid"></div>
        <div id="chapterGrid" class="grid chapter-list hidden"></div>
        <div id="searchList" class="list-view hidden"></div>
        <div id="loader" class="loading hidden"><span class="material-icons-round spin">sync</span><br><span>Processing...</span></div>
    </section>

    <!-- VIEW 2: READER -->
    <section id="view-reader" class="hidden">
        <div id="contentArea"></div>
        <div id="readerLoading" class="loading hidden"><span class="material-icons-round spin">sync</span><br><span>Loading...</span></div>
    </section>
</main>

<!-- AUDIO PLAYER -->
<div id="audioPlayerPopup">
    <div class="player-header">
        <div style="display:flex; flex-direction:column">
            <strong id="audioTrackInfo">Audio</strong>
        </div>
        <div style="display:flex; gap:12px; align-items:center; position:relative">
             <button class="speed-btn" id="btnSpeed" onclick="ReaderAudio.toggleSpeedPopup()">1.0x</button>
             <div id="speedControlPopup">
                <span style="font-size:12px; font-weight:700" id="speedLabelVal">1.0</span>
                <div class="v-slider-wrapper">
                    <input type="range" class="v-slider" min="0.25" max="2.5" step="0.25" value="1.0" oninput="ReaderAudio.setSpeed(this.value)">
                </div>
                <span class="material-icons-round" style="font-size:16px; opacity:0.5">speed</span>
             </div>
             <button class="ctrl-btn" onclick="ReaderAudio.hide()"><span class="material-icons-round">keyboard_arrow_up</span></button>
        </div>
    </div>
    <div class="player-controls">
        <button class="ctrl-btn" onclick="ReaderAudio.seek(-10)"><span class="material-icons-round">replay_10</span></button>
        <button class="play-fab" id="fabPlay" onclick="ReaderAudio.togglePlay()"><span class="material-icons-round">play_arrow</span></button>
        <button class="ctrl-btn" onclick="ReaderAudio.seek(10)"><span class="material-icons-round">forward_10</span></button>
    </div>
    <div class="scrubber-container">
        <div class="wave-track">
            <div class="wave-bg"></div>
            <div class="wave-fill" id="waveFill"></div>
            <input type="range" class="wavy-slider" id="scrubber" min="0" max="100" value="0" oninput="ReaderAudio.handleScrub(this.value)">
        </div>
    </div>
</div>

<!-- SELECTION MENU -->
<div id="selectionIsland">
    <div class="island-row" id="rowWordTools" style="display:none">
        <button class="fab-btn" onclick="Reader.getDefinition()"><span class="material-icons-round">local_library</span> Define</button>
    </div>
    <div id="sepWordTools" class="sep-row" style="display:none"></div>
    <div class="island-row">
        <button class="fab-btn" onclick="Reader.openNote()"><span class="material-icons-round">edit_note</span> Note</button>
        <button class="fab-btn" onclick="Reader.clearSel()"><span class="material-icons-round">close</span></button>
    </div>
    <div class="sep-row"></div>
    <div class="color-dots island-row">
        <div class="swatch s-yellow" onclick="Reader.applyColor('hl-yellow')"></div>
        <div class="swatch s-green" onclick="Reader.applyColor('hl-green')"></div>
        <div class="swatch s-blue" onclick="Reader.applyColor('hl-blue')"></div>
        <div class="swatch s-red" onclick="Reader.applyColor('hl-red')"></div>
        <div class="swatch s-clear" onclick="Reader.applyColor(null)"></div>
    </div>
</div>

<!-- LEXICON MODAL -->
<div id="lexiconModal" onclick="Reader.closeLexicon(event)">
    <div class="modal-card" style="max-height:60vh; overflow-y:auto" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span style="font-weight:700">Definition</span>
        </div>
        <div id="lexiconContent" style="margin-top:16px; font-family:'Roboto',sans-serif">Loading...</div>
    </div>
</div>

<!-- NOTE MODAL -->
<div id="noteModal" onclick="Reader.closeNote(event)">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span id="noteTitle">Note</span>
        </div>
        <textarea id="noteInput" placeholder="Write thoughts..."></textarea>
        <div class="modal-actions">
            <button class="btn-text" onclick="Reader.saveNote()">Save</button>
        </div>
    </div>
</div>

<script src="js/adapter.js"></script>
<script src="js/app.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
</script>
</body>
</html>
