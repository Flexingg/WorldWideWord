<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WordWideWeb</title>
    <meta name="description" content="Offline-first Bible Reader">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@400;500&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header id="mainHeader">
    <button class="nav-btn hidden" id="btnBack" onclick="App.navBack()"><span class="material-icons-round">arrow_back</span></button>
    <div style="display:flex; align-items:center; gap:4px; flex-grow:1">
        <button class="title-chip" onclick="App.goHome()">
            <span class="material-icons-round" style="color:var(--primary-color)">menu_book</span>
            <span id="headerLabel">The Bible</span>
        </button>
    </div>
    <div style="display:flex; align-items:center" id="headerActions">
        <!-- Selector Actions -->
        <button class="icon-btn" id="btnPlans" onclick="ReadingPlans.showDashboard()"><span class="material-icons-round">calendar_month</span></button>
        <button class="icon-btn" id="btnHistory" onclick="Selector.toggleHistory()"><span class="material-icons-round">history</span></button>
        <!-- Reader Actions -->
        <button class="nav-btn hidden" id="btnStop" onclick="ReaderAudio.stop()" style="color:var(--primary-color)"><span class="material-icons-round">stop_circle</span></button>
        <button class="nav-btn hidden" id="btnShare" onclick="Reader.shareChapter()" title="Share"><span class="material-icons-round">share</span></button>
        <button class="nav-btn hidden" id="btnAudio" onclick="ReaderAudio.toggleUI()"><span class="material-icons-round">headphones</span></button>
        <button class="nav-btn hidden" id="btnNextChap" onclick="Reader.navNext()"><span class="material-icons-round">chevron_right</span></button>
        <!-- Global -->
        <button class="icon-btn" onclick="Settings.openModal()"><span class="material-icons-round">settings</span></button>
        <button class="icon-btn" onclick="App.toggleTheme()"><span class="material-icons-round" id="themeIcon">dark_mode</span></button>
    </div>
</header>

<main>
    <!-- VIEW 1: SELECTOR -->
    <section id="view-selector">
        <div class="search-wrapper">
            <div class="search-container" id="searchBox">
                <span class="material-icons-round" id="searchIcon">filter_list</span>
                <form onsubmit="Selector.handleSearch(event)">
                    <input type="text" id="searchInput" placeholder="Filter books..." onkeyup="Selector.handleInput(this.value)" autocomplete="off">
                </form>
            </div>
            <button class="mode-toggle" id="btnMode" onclick="Selector.toggleSearchMode()">
                <span class="material-icons-round">search</span>
            </button>
        </div>

        <div id="bookGrid" class="grid"></div>
        <div id="chapterGrid" class="grid chapter-list hidden"></div>
        <div id="searchList" class="list-view hidden"></div>
        <div id="historyList" class="list-view hidden"></div>
        <div id="loader" class="loading hidden"><span class="material-icons-round spin">sync</span><br><span>Searching...</span></div>
    </section>

    <!-- VIEW 2: READER -->
    <section id="view-reader" class="hidden">
        <div id="contentArea"></div>
        <div id="readerLoading" class="loading hidden"><span class="material-icons-round spin">sync</span><br><span>Loading...</span></div>
    </section>

    <!-- VIEW 3: READING PLANS DASHBOARD -->
    <section id="view-plans" class="hidden">
        <div id="plansLoader" class="loading"><span class="material-icons-round spin">sync</span><br><span>Loading plans...</span></div>
        <div id="plansList" class="plans-list"></div>
    </section>

    <!-- VIEW 3b: READING PLANS DAY GRID (used for both preview and subscribed) -->
    <section id="view-plans-grid" class="hidden">
        <div id="planDayGrid" class="day-grid"></div>
    </section>

    <!-- VIEW 4: READING PLANS DAY VIEW -->
    <section id="view-plans-day" class="hidden">
        <div class="day-nav">
            <button class="nav-btn" id="btnPrevDay"><span class="material-icons-round">chevron_left</span></button>
            <button class="nav-btn" id="btnNextDay"><span class="material-icons-round">chevron_right</span></button>
        </div>
        <div id="dayReadingsList" class="day-readings-list"></div>
        <div class="day-actions">
            <button class="btn-fill btn-complete" id="btnMarkComplete">
                <span class="material-icons-round">radio_button_unchecked</span> Mark Complete
            </button>
        </div>
    </section>
</main>

<!-- AUDIO PLAYER -->
<div id="audioPlayerPopup">
    <div class="player-header">
        <div style="display:flex; flex-direction:column">
            <strong id="audioTrackInfo">Audio</strong>
            <span style="font-size:12px; opacity:0.7">Narrated Audio</span>
        </div>
        <div style="display:flex; gap:12px; align-items:center; position:relative">
             <button class="speed-btn" id="btnSpeed" onclick="ReaderAudio.toggleSpeedPopup()">1.0x</button>
             <div id="speedControlPopup">
                <span style="font-size:12px; font-weight:700" id="speedLabelVal">1.0</span>
                <div class="v-slider-wrapper">
                    <input type="range" class="v-slider" min="0.25" max="2.5" step="0.25" value="1.0" oninput="ReaderAudio.setSpeed(this.value)">
                </div>
                <span class="material-icons-round" style="font-size:16px; opacity:0.5">speed</span>
             </div>
             <button class="ctrl-btn" onclick="ReaderAudio.hide()"><span class="material-icons-round">keyboard_arrow_up</span></button>
        </div>
    </div>
    <div class="player-controls">
        <button class="ctrl-btn" id="btnAutoPlay" onclick="ReaderAudio.toggleAutoPlay()"><span class="material-icons-round">published_with_changes</span></button>
        <button class="ctrl-btn" onclick="ReaderAudio.seek(-10)"><span class="material-icons-round">replay_10</span></button>
        <button class="play-fab" id="fabPlay" onclick="ReaderAudio.togglePlay()"><span class="material-icons-round">play_arrow</span></button>
        <button class="ctrl-btn" onclick="ReaderAudio.seek(10)"><span class="material-icons-round">forward_10</span></button>
        <button class="ctrl-btn" onclick="Reader.navNext()"><span class="material-icons-round">skip_next</span></button>
    </div>
    <div class="scrubber-container">
        <span id="timeCurr">0:00</span>
        <div class="wave-track">
            <div class="wave-bg"></div>
            <div class="wave-fill" id="waveFill"></div>
            <input type="range" class="wavy-slider" id="scrubber" min="0" max="100" value="0" oninput="ReaderAudio.handleScrub(this.value)">
        </div>
        <span id="timeTotal">--:--</span>
    </div>
</div>

<!-- SELECTION MENU -->
<div id="selectionIsland">
    <!-- Row 1: Word Tools (Hidden by default) -->
    <div class="island-row" id="rowWordTools" style="display:none">
        <button class="fab-btn" onclick="Reader.getDefinition()">
            <span class="material-icons-round">local_library</span> Define
        </button>
        <div class="sep"></div>
        <button class="fab-btn" onclick="Reader.findUsage()">
            <span class="material-icons-round">manage_search</span> <span>Usage</span>
        </button>
    </div>
    <div id="sepWordTools" class="sep-row" style="display:none"></div>

    <!-- Row 2: Actions -->
    <div class="island-row">
        <button class="fab-btn" id="btnAutoScroll" onclick="ReaderScroll.toggle()">
            <span class="material-icons-round">unfold_more</span> <span>Scroll</span>
        </button>
        <button class="fab-btn" style="display:none" id="scrollSpeedBtn" onclick="ReaderScroll.cycleSpeed()">
            <span id="scrollSpeedLabel">1x</span>
        </button>
        <div class="sep"></div>
        <button class="fab-btn" onclick="Reader.openNote()">
            <span class="material-icons-round">edit_note</span> Note
        </button>
        <button class="fab-btn" onclick="Reader.copySelection()">
            <span class="material-icons-round">content_copy</span> Copy
        </button>
        <button class="fab-btn" onclick="Reader.clearSelection()">
            <span class="material-icons-round">close</span>
        </button>
    </div>
    <div class="sep-row"></div>
    
    <!-- Row 3: Colors -->
    <div class="color-dots island-row">
        <div class="swatch s-yellow" onclick="Reader.applyColor('hl-yellow')"></div>
        <div class="swatch s-green" onclick="Reader.applyColor('hl-green')"></div>
        <div class="swatch s-blue" onclick="Reader.applyColor('hl-blue')"></div>
        <div class="swatch s-red" onclick="Reader.applyColor('hl-red')"></div>
        <div class="swatch s-clear" onclick="Reader.applyColor(null)"></div>
    </div>
</div>

<!-- MODALS -->
<div id="lexiconModal" onclick="Reader.closeLexicon(event)">
    <div class="modal-card" style="max-height:60vh; overflow-y:auto" onclick="event.stopPropagation()">
        <div class="modal-header"><span style="font-weight:700">Definition</span></div>
        <div id="lexiconContent" style="margin-top:16px; font-family:'Roboto',sans-serif">Loading...</div>
    </div>
</div>

<div id="noteModal" onclick="Reader.closeNote(event)">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-header"><span id="noteTitle">Note</span></div>
        <textarea id="noteInput" placeholder="Write thoughts..."></textarea>
        <div class="modal-actions">
            <button class="btn-text" onclick="Reader.deleteNote()">Delete</button>
            <button class="btn-fill" onclick="Reader.saveNote()">Save</button>
        </div>
    </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" onclick="Settings.closeModal(event)">
    <div class="settings-card" onclick="event.stopPropagation()">
        <div class="settings-header">
            <span class="settings-title">Settings</span>
            <button class="settings-close" onclick="Settings.closeModal()">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        
        <!-- Reading Section -->
        <div class="settings-section">
            <div class="settings-section-title">
                <span class="material-icons-round">text_fields</span>
                Reading
            </div>
            
            <div class="settings-row">
                <span class="settings-label">Font Family</span>
                <div class="font-toggle">
                    <button class="font-toggle-btn active" id="fontSerifBtn" onclick="Settings.setFontFamily('serif')">Serif</button>
                    <button class="font-toggle-btn" id="fontSansBtn" onclick="Settings.setFontFamily('sans')">Sans</button>
                </div>
            </div>
            
            <div class="settings-row">
                <span class="settings-label">Font Size</span>
                <div class="settings-slider">
                    <input type="range" class="h-slider" id="fontSizeSlider" min="14" max="28" value="19" oninput="Settings.setFontSize(this.value)">
                    <span class="settings-value" id="fontSizeValue">19px</span>
                </div>
            </div>
            
            <div class="settings-row">
                <span class="settings-label">Line Height</span>
                <div class="settings-slider">
                    <input type="range" class="h-slider" id="lineHeightSlider" min="1.4" max="2.2" step="0.1" value="1.7" oninput="Settings.setLineHeight(this.value)">
                    <span class="settings-value" id="lineHeightValue">1.7</span>
                </div>
            </div>
        </div>
        
        <!-- Appearance Section -->
        <div class="settings-section">
            <div class="settings-section-title">
                <span class="material-icons-round">palette</span>
                Appearance
            </div>
            
            <div class="theme-grid">
                <div class="theme-option" data-theme-option="light" onclick="Settings.setTheme('light')">
                    <div class="theme-preview theme-preview-light"></div>
                    <span class="theme-name">Light</span>
                </div>
                <div class="theme-option" data-theme-option="dark" onclick="Settings.setTheme('dark')">
                    <div class="theme-preview theme-preview-dark"></div>
                    <span class="theme-name">Dark</span>
                </div>
                <div class="theme-option" data-theme-option="oled" onclick="Settings.setTheme('oled')">
                    <div class="theme-preview theme-preview-oled"></div>
                    <span class="theme-name">AMOLED</span>
                </div>
            </div>
            
            <!-- Accent Color Picker -->
            <div class="accent-color-section">
                <div class="settings-label">Accent Color</div>
                <div class="color-picker-wrapper">
                    <input type="color" class="color-picker-input" id="accentColorPicker" value="#0061a4" onchange="Settings.setAccentColor(this.value)">
                    <div class="color-presets">
                        <div class="color-preset" style="background: #0061a4" onclick="Settings.setAccentColor('#0061a4')"></div>
                        <div class="color-preset" style="background: #d93025" onclick="Settings.setAccentColor('#d93025')"></div>
                        <div class="color-preset" style="background: #1e8e3e" onclick="Settings.setAccentColor('#1e8e3e')"></div>
                        <div class="color-preset" style="background: #f9ab00" onclick="Settings.setAccentColor('#f9ab00')"></div>
                        <div class="color-preset" style="background: #9334e6" onclick="Settings.setAccentColor('#9334e6')"></div>
                        <div class="color-preset" style="background: #0b8043" onclick="Settings.setAccentColor('#0b8043')"></div>
                        <div class="color-preset" style="background: #e8710a" onclick="Settings.setAccentColor('#e8710a')"></div>
                        <div class="color-preset" style="background: #149da6" onclick="Settings.setAccentColor('#149da6')"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="settings-reset" onclick="Settings.reset()">
            Reset to Defaults
        </button>
    </div>
</div>

<!-- SCRIPTS -->
<script src="js/adapter.js"></script>
<script src="js/app.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
</script>
</body>
</html>